
import InitialLevel from "../levels/levelsTopDown/initialLevel.js"

import LevelTopDown1A from "../levels/levelsTopDown/Dungeon 1/levelTopDown1A.js"
import LevelTopDown1B_E from "../levels/levelsTopDown/Dungeon 1/LevelTopDown1B-E.js"
import LevelTopDown1B_N from "../levels/levelsTopDown/Dungeon 1/LevelTopDown1B-N.js"
import LevelTopDown1B_S from "../levels/levelsTopDown/Dungeon 1/LevelTopDown1B-S.js"
import LevelTopDown1B_O from "../levels/levelsTopDown/Dungeon 1/LevelTopDown1B-O.js"
import LevelTopDown1C_NE from "../levels/levelsTopDown/Dungeon 1/levelTopDown1C-NE.js"
import LevelTopDown1C_NS from "../levels/levelsTopDown/Dungeon 1/levelTopDown1C-NS.js"
import LevelTopDown1C_NO from "../levels/levelsTopDown/Dungeon 1/levelTopDown1C-NO.js"
import LevelTopDown1C_SE from "../levels/levelsTopDown/Dungeon 1/levelTopDown1C-ES.js"
import LevelTopDown1C_SO from "../levels/levelsTopDown/Dungeon 1/levelTopDown1C-SO.js"
import LevelTopDown1C_EO from "../levels/levelsTopDown/Dungeon 1/levelTopDown1C-EO.js"
import LevelTopDown1D_E from "../levels/levelsTopDown/Dungeon 1/levelTopDown1D-E.js"
import LevelTopDown1D_N from "../levels/levelsTopDown/Dungeon 1/levelTopDown1D-N.js"
import LevelTopDown1D_O from "../levels/levelsTopDown/Dungeon 1/levelTopDown1D-O.js"
import LevelTopDown1D_S from "../levels/levelsTopDown/Dungeon 1/levelTopDown1D-S.js"

import LevelTopDown2A from "../levels/levelsTopDown/Dungeon 2/levelTopDown2A.js"
import LevelTopDown2B_E from "../levels/levelsTopDown/Dungeon 2/LevelTopDown2B-E.js"
import LevelTopDown2B_N from "../levels/levelsTopDown/Dungeon 2/LevelTopDown2B-N.js"
import LevelTopDown2B_S from "../levels/levelsTopDown/Dungeon 2/LevelTopDown2B-S.js"
import LevelTopDown2B_O from "../levels/levelsTopDown/Dungeon 2/LevelTopDown2B-O.js"
import LevelTopDown2C_NE from "../levels/levelsTopDown/Dungeon 2/levelTopDown2C-NE.js"
import LevelTopDown2C_NS from "../levels/levelsTopDown/Dungeon 2/levelTopDown2C-NS.js"
import LevelTopDown2C_NO from "../levels/levelsTopDown/Dungeon 2/levelTopDown2C-NO.js"
import LevelTopDown2C_SE from "../levels/levelsTopDown/Dungeon 2/levelTopDown2C-ES.js"
import LevelTopDown2C_SO from "../levels/levelsTopDown/Dungeon 2/levelTopDown2C-SO.js"
import LevelTopDown2C_EO from "../levels/levelsTopDown/Dungeon 2/levelTopDown2C-EO.js"
import LevelTopDown2D_E from "../levels/levelsTopDown/Dungeon 2/levelTopDown2D-E.js"
import LevelTopDown2D_N from "../levels/levelsTopDown/Dungeon 2/levelTopDown2D-N.js"
import LevelTopDown2D_O from "../levels/levelsTopDown/Dungeon 2/levelTopDown2D-O.js"
import LevelTopDown2D_S from "../levels/levelsTopDown/Dungeon 2/levelTopDown2D-S.js"

import LevelTopDown3A from "../levels/levelsTopDown/Dungeon 3/levelTopDown3A.js"
import LevelTopDown3B_E from "../levels/levelsTopDown/Dungeon 3/LevelTopDown3B-E.js"
import LevelTopDown3B_N from "../levels/levelsTopDown/Dungeon 3/LevelTopDown3B-N.js"
import LevelTopDown3B_S from "../levels/levelsTopDown/Dungeon 3/LevelTopDown3B-S.js"
import LevelTopDown3B_O from "../levels/levelsTopDown/Dungeon 3/LevelTopDown3B-O.js"
import LevelTopDown3C_NE from "../levels/levelsTopDown/Dungeon 3/levelTopDown3C-NE.js"
import LevelTopDown3C_NS from "../levels/levelsTopDown/Dungeon 3/levelTopDown3C-NS.js"
import LevelTopDown3C_NO from "../levels/levelsTopDown/Dungeon 3/levelTopDown3C-NO.js"
import LevelTopDown3C_SE from "../levels/levelsTopDown/Dungeon 3/levelTopDown3C-ES.js"
import LevelTopDown3C_SO from "../levels/levelsTopDown/Dungeon 3/levelTopDown3C-SO.js"
import LevelTopDown3C_EO from "../levels/levelsTopDown/Dungeon 3/levelTopDown3C-EO.js"
import LevelTopDown3D_E from "../levels/levelsTopDown/Dungeon 3/levelTopDown3D-E.js"
import LevelTopDown3D_N from "../levels/levelsTopDown/Dungeon 3/levelTopDown3D-N.js"
import LevelTopDown3D_O from "../levels/levelsTopDown/Dungeon 3/levelTopDown3D-O.js"
import LevelTopDown3D_S from "../levels/levelsTopDown/Dungeon 3/levelTopDown3D-S.js"

import LevelTopDown4A from "../levels/levelsTopDown/Dungeon 4/levelTopDown4A.js"
import LevelTopDown4B_E from "../levels/levelsTopDown/Dungeon 4/LevelTopDown4B-E.js"
import LevelTopDown4B_N from "../levels/levelsTopDown/Dungeon 4/LevelTopDown4B-N.js"
import LevelTopDown4B_S from "../levels/levelsTopDown/Dungeon 4/LevelTopDown4B-S.js"
import LevelTopDown4B_O from "../levels/levelsTopDown/Dungeon 4/LevelTopDown4B-O.js"
import LevelTopDown4C_NE from "../levels/levelsTopDown/Dungeon 4/levelTopDown4C-NE.js"
import LevelTopDown4C_NS from "../levels/levelsTopDown/Dungeon 4/levelTopDown4C-NS.js"
import LevelTopDown4C_NO from "../levels/levelsTopDown/Dungeon 4/levelTopDown4C-NO.js"
import LevelTopDown4C_SE from "../levels/levelsTopDown/Dungeon 4/levelTopDown4C-ES.js"
import LevelTopDown4C_SO from "../levels/levelsTopDown/Dungeon 4/levelTopDown4C-SO.js"
import LevelTopDown4C_EO from "../levels/levelsTopDown/Dungeon 4/levelTopDown4C-EO.js"
import LevelTopDown4D_E from "../levels/levelsTopDown/Dungeon 4/levelTopDown4D-E.js"
import LevelTopDown4D_N from "../levels/levelsTopDown/Dungeon 4/levelTopDown4D-N.js"
import LevelTopDown4D_O from "../levels/levelsTopDown/Dungeon 4/levelTopDown4D-O.js"
import LevelTopDown4D_S from "../levels/levelsTopDown/Dungeon 4/levelTopDown4D-S.js"

import LevelTopDown5A from "../levels/levelsTopDown/Dungeon 5/levelTopDown5A.js"
import LevelTopDown5B_E from "../levels/levelsTopDown/Dungeon 5/LevelTopDown5B-E.js"
import LevelTopDown5B_N from "../levels/levelsTopDown/Dungeon 5/LevelTopDown5B-N.js"
import LevelTopDown5B_S from "../levels/levelsTopDown/Dungeon 5/LevelTopDown5B-S.js"
import LevelTopDown5B_O from "../levels/levelsTopDown/Dungeon 5/LevelTopDown5B-O.js"
import LevelTopDown5C_NE from "../levels/levelsTopDown/Dungeon 5/levelTopDown5C-NE.js"
import LevelTopDown5C_NS from "../levels/levelsTopDown/Dungeon 5/levelTopDown5C-NS.js"
import LevelTopDown5C_NO from "../levels/levelsTopDown/Dungeon 5/levelTopDown5C-NO.js"
import LevelTopDown5C_SE from "../levels/levelsTopDown/Dungeon 5/levelTopDown5C-ES.js"
import LevelTopDown5C_SO from "../levels/levelsTopDown/Dungeon 5/levelTopDown5C-SO.js"
import LevelTopDown5C_EO from "../levels/levelsTopDown/Dungeon 5/levelTopDown5C-EO.js"
import LevelTopDown5D_E from "../levels/levelsTopDown/Dungeon 5/levelTopDown5D-E.js"
import LevelTopDown5D_N from "../levels/levelsTopDown/Dungeon 5/levelTopDown5D-N.js"
import LevelTopDown5D_O from "../levels/levelsTopDown/Dungeon 5/levelTopDown5D-O.js"
import LevelTopDown5D_S from "../levels/levelsTopDown/Dungeon 5/levelTopDown5D-S.js"

import LevelTopDownBigE from "../levels/levelsTopDown/Dungeon Big/LevelTopDownBigE.js"
import LevelTopDownBigW from "../levels/levelsTopDown/Dungeon Big/LevelTopDownBigW.js"
import LevelTopDownBigS from "../levels/levelsTopDown/Dungeon Big/LevelTopDownBigS.js"
import LevelTopDownBigN from "../levels/levelsTopDown/Dungeon Big/LevelTopDownBigN.js"

import ChestRoomE from "../levels/levelsTopDown/chestRoomE.js"
import ChestRoomN from "../levels/levelsTopDown/chestRoomN.js"
import ChestRoomS from "../levels/levelsTopDown/chestRoomS.js"
import ChestRoomW from "../levels/levelsTopDown/chestRoomW.js"



export default class SceneManager {
        /*
        arriba der: 1100 200
        arriba izq: 200 200
        abajo der: 1050 800
        abajo izq: 200 800
        mitad: 640, 500
        */

    constructor() {
        this.sceneList = [
            LevelTopDown1C_NE, LevelTopDown1B_E, LevelTopDown1B_N, LevelTopDown1B_O, LevelTopDown1B_S, LevelTopDown1C_NS, LevelTopDown1C_NO, LevelTopDown1C_SE, LevelTopDown1C_SO, LevelTopDown1C_EO,
            LevelTopDown2A, LevelTopDown2C_NE, LevelTopDown2B_E, LevelTopDown2B_N, LevelTopDown2B_O, LevelTopDown2B_S, LevelTopDown2C_NS, LevelTopDown2C_NO, LevelTopDown2C_SE, LevelTopDown2C_SO, LevelTopDown2C_EO, 
            LevelTopDown3A, LevelTopDown3C_NE, LevelTopDown3B_E, LevelTopDown3B_N, LevelTopDown3B_O, LevelTopDown3B_S, LevelTopDown3C_NS, LevelTopDown3C_NO, LevelTopDown3C_SE, LevelTopDown3C_SO, LevelTopDown3C_EO,     
            LevelTopDown4A, LevelTopDown4C_NE, LevelTopDown4B_E, LevelTopDown4B_N, LevelTopDown4B_O, LevelTopDown4B_S, LevelTopDown4C_NS, LevelTopDown4C_NO, LevelTopDown4C_SE, LevelTopDown4C_SO, LevelTopDown4C_EO, 
            LevelTopDown5A, LevelTopDown5C_NE, LevelTopDown5B_E, LevelTopDown5B_N, LevelTopDown5B_O, LevelTopDown5B_S, LevelTopDown5C_NS, LevelTopDown5C_NO, LevelTopDown5C_SE, LevelTopDown5C_SO, LevelTopDown5C_EO, 
                          ];
        this.profundidadMinima = 1;
        this.profundidadMaxima = 3;

        this.endSceneList = [
            LevelTopDown1D_E, LevelTopDown1D_N, LevelTopDown1D_S, LevelTopDown1D_O,
            LevelTopDown2D_E, LevelTopDown2D_N, LevelTopDown2D_S, LevelTopDown2D_O, 
            LevelTopDown3D_E, LevelTopDown3D_N, LevelTopDown3D_S, LevelTopDown3D_O, 
            LevelTopDown4D_E, LevelTopDown4D_N, LevelTopDown4D_S, LevelTopDown4D_O, 
            LevelTopDown5D_E, LevelTopDown5D_N, LevelTopDown5D_S, LevelTopDown5D_O,
        ];
        this.chestLevelList = [ChestRoomE, ChestRoomN, ChestRoomS, ChestRoomW];
        this.bossLevelList = [LevelTopDownBigE, LevelTopDownBigN, LevelTopDownBigS, LevelTopDownBigW];
        this.levelCont = 0;
    }

    generateMap() {
        this.levelList = this.createRandomizedList(this.sceneList);
        this.endLevelList = this.createRandomizedList(this.endSceneList);
        this.finalLevels = [];

        const escenaPadre = new InitialLevel();
        escenaPadre.grid = { x: 0, y: 0 };
        this.finalLevels.push(escenaPadre);
        this.addLevel(1, 0, 1, false, 1);
        const westLevel = this.finalLevels.find((e) => {return (e.grid.x == -1) && e.grid.y == 0});

        if (westLevel == undefined) {
            this.addLevel(-1, 0, 1, false, 3);
        }

        const southLevel = this.finalLevels.find((e) => {return (e.grid.x == 0 && e.grid.y == 1)});

        if (southLevel == undefined) {
            this.addLevel(0, 1, 1, false, 2);
        }

        const nortLevel = this.finalLevels.find((e) => {return (e.grid.x == 0 && e.grid.y == -1)});

        if (nortLevel == undefined) {
            this.addLevel(0, -1, 1, false, 0);
        }

        this.finalLevels = this.addChestLevel(this.finalLevels);

        return this.finalLevels;

    }

    addLevel(x, y, profundidad, finished, sentido) {

        let i = -1;
        let imposible = false;
        let extractionList
        if (!finished)
            extractionList = this.levelList;
        else
            extractionList = this.endLevelList;
        let levelHijo = null;
        const thisKey = this.levelCont.toString();

        while (true) {
            if (!finished) {
                i += 1;
                if (i >= extractionList.length) {
                    if (imposible) {
                        extractionList = this.createRandomizedList(this.endSceneList);
                        i = 0;
                    }
                    else {
                        extractionList = this.createRandomizedList(this.sceneList);
                        i = 0;
                        imposible = true;
                    }
                }
            }
            else {
                i += 1;
                if (i >= extractionList.length) {
                    if (imposible) {
                        extractionList = this.createRandomizedList(this.sceneList);
                        i = 0;
                    }
                    else {
                        extractionList = this.createRandomizedList(this.endSceneList);
                        i = 0;
                        imposible = true;
                    }
                }
            }
            if (levelHijo != null) {
                //levelHijo.destroy();
            }
            levelHijo = new extractionList[i](thisKey);
            if (sentido == 0) {
                if (!levelHijo.doors.south) continue;
            }
            else if (sentido == 1) {
                if (!levelHijo.doors.west) continue;
            }
            else if (sentido == 2) {
                if (!levelHijo.doors.north) continue;
            }
            else {
                if (!levelHijo.doors.east) continue;
            }

            const westLevel = this.finalLevels.find((e) => { return e.grid.x == (x - 1) && e.grid.y == y });
            if (westLevel != undefined) {
                if (levelHijo.doors.west != westLevel.doors.east) continue;
            }
            const southLevel = this.finalLevels.find((e) => { return e.grid.x == x && e.grid.y == (y + 1) });
            if (southLevel != undefined) {
                if (levelHijo.doors.south != southLevel.doors.north) continue;
            }
            const eastLevel = this.finalLevels.find((e) => { return e.grid.x == (x + 1) && e.grid.y == y });
            if (eastLevel != undefined) {
                if (levelHijo.doors.east != eastLevel.doors.west) continue;
            }
            const nortLevel = this.finalLevels.find((e) => { return e.grid.x == x && e.grid.y == (y - 1)});
            if (nortLevel != undefined) {
                if (levelHijo.doors.north != nortLevel.doors.south) continue;
            }
            break;
        }

        levelHijo.grid = { x: x, y: y };
        if (extractionList == this.levelList) {
            this.levelList.splice(i, 1);
            if (this.levelList.length == 0) {
                this.levelList = this.createRandomizedList(this.sceneList);
            }
        }

        let finalizar = finished;
        if (!finished) {
            if (Math.random() < (profundidad * (1 / (this.profundidadMaxima - (this.profundidadMinima - 1))) - ((1 / (this.profundidadMaxima - (this.profundidadMinima - 1))) * (this.profundidadMinima - 1)))) {
                finalizar = true;
            }
        }
        this.levelCont += 1;
        this.finalLevels.push(levelHijo);
        const westLevel = this.finalLevels.find((e) => { return (e.grid.x == (x - 1) && e.grid.y == y) });
        if (levelHijo.doors.west) {
            if (westLevel != undefined) {
                levelHijo.changeSceneManager.west = westLevel.levelkey;
                westLevel.changeSceneManager.east = thisKey;
            }
            else {
                this.addLevel(x - 1, y, profundidad + 1, finalizar, 3);
            }
        }
        const southLevel = this.finalLevels.find((e) => { return (e.grid.x == x && e.grid.y == (y + 1)) });
        if (levelHijo.doors.south) {
            if (southLevel != undefined) {
                levelHijo.changeSceneManager.south = southLevel.levelkey;
                southLevel.changeSceneManager.north = thisKey;
            }
            else {
                this.addLevel(x, y + 1, profundidad + 1, finalizar, 2);
            }
        }
        const eastLevel = this.finalLevels.find((e) => { return (e.grid.x == (x + 1) && e.grid.y == y) });
        if (levelHijo.doors.east) {
            if (eastLevel != undefined) {
                levelHijo.changeSceneManager.east = eastLevel.levelkey;
                eastLevel.changeSceneManager.west = thisKey;
            }
            else {
                this.addLevel(x + 1, y, profundidad + 1, finalizar, 1);
            }
        }
        const nortLevel = this.finalLevels.find((e) => { return (e.grid.x == x && e.grid.y == (y - 1)) });
        if (levelHijo.doors.north) {
            if (nortLevel != undefined) {
                levelHijo.changeSceneManager.north = nortLevel.levelkey;
                nortLevel.changeSceneManager.south = thisKey;
            }
            else {
                this.addLevel(x, y - 1, profundidad + 1, finalizar, 0);
            }
        }
    }

    createRandomizedList(list) {
        const auxList = list.slice();
        let randomList = [];
        while (auxList.length != 0) {
            let index = Math.floor(Math.random() * auxList.length);
            randomList.push(auxList[index]);
            auxList.splice(index, 1);
        }
        return randomList;
    }


    addChestLevel(list) {
        const oneDoors = list.filter(e => { return e.doorNumbers == 1 });
        const moreDoors = list.filter(e => { return e.doorNumbers != 1 });
        
        const bossLevel = this.switchLevel(this.bossLevelList, oneDoors);

        if(oneDoors.length <= 0){
            oneDoors.push(bossLevel);
            return moreDoors.concat(oneDoors);
        } 
        const chestLevel = this.switchChestLevel(this.chestLevelList, oneDoors, true);

        if(oneDoors.length <= 0) {
            oneDoors.push(bossLevel);
            oneDoors.push(chestLevel);
            return moreDoors.concat(oneDoors);
        }

        const mimicLevel = this.switchChestLevel(this.chestLevelList, oneDoors, false);

        oneDoors.push(bossLevel);
        oneDoors.push(chestLevel);
        oneDoors.push(mimicLevel);
        return moreDoors.concat(oneDoors);
    }


    switchChestLevel(listFromSust, listToSust, isReal){
        let index = Math.floor(Math.random() * listToSust.length);
        let salaSustituir = listToSust[index];
        listToSust.splice(index, 1);
        return this.swapChestLevel(listFromSust, salaSustituir, isReal);
    }

    switchLevel(listFromSust, listToSust){
        let index = Math.floor(Math.random() * listToSust.length);
        let salaSustituir = listToSust[index];
        listToSust.splice(index, 1);
        return this.swapLevel(listFromSust, salaSustituir);
    }



    swapChestLevel(list, salaSustituir, isReal){
        const chestList = this.createRandomizedList(list);
        let chestLevel
        for(let i = 0; i < chestList.length; i++){
            chestLevel = new chestList[i](salaSustituir.levelkey, isReal);
            if(this.doorsEqual(chestLevel.doors,salaSustituir.doors)) break;
        }
        chestLevel.changeSceneManager = salaSustituir.changeSceneManager;
        chestLevel.grid = salaSustituir.grid;
        return chestLevel
    }
    swapLevel(list, salaSustituir){
        const chestList = this.createRandomizedList(list);
        let chestLevel
        for(let i = 0; i < chestList.length; i++){
            chestLevel = new chestList[i](salaSustituir.levelkey);
            if(this.doorsEqual(chestLevel.doors,salaSustituir.doors)) break;
        }
        chestLevel.changeSceneManager = salaSustituir.changeSceneManager;
        chestLevel.grid = salaSustituir.grid;
        return chestLevel
    }
    doorsEqual(doors1, doors2){
        return (doors1.north == doors2.north && doors1.south == doors2.south && doors1.west == doors2.west && doors1.east == doors2.east)
    }
}